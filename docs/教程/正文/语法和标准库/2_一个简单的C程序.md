# 一个简单的 C 程序

```c
#include <stdio.h>
#include <assert.h>

/*
 * 这是 main 函数 (main function)
 * 一般情况下（有宿主环境）C 程序的入口点
 */
int main(void) {

    // 输出一行字
    puts("Hello world!");

    int a, b;
    scanf("%d%d", &a, &b);

    assert(b != 0);
    printf("%g\n", (double)a / b);

    return 0;
}
```

这个程序会首先输出 `Hello world!`；然后等待我们输入两个整数，检查第二个整数是否为 0（除数不能为 0）：如果是 0，就输出一套错误信息；如果不是 0，就计算并输出第一个整数除以第二个整数的结果。

你可以将以上代码保存到自己的电脑里面，命名为 `main.c`。像这样存储代码的文件被称为**源文件**。C 语言的源文件的名称应该以 `.c` 结尾。

## 1. C 项目的创建（以 Lightly 为例）

1. [打开 **Lightly**
   ![打开 Lightly](/images/语法和标准库/2_一个简单的C程序/001.png)](https://lightly.teamcode.com/)

2. 点击**在线使用**
   ![在线使用](/images/语法和标准库/2_一个简单的C程序/002.png)

3. 点击**新建项目**，选择 **C**，**C 语言标准**选择 **C11**，项目名称自拟，其他可选项默认

4. 经过一小段时间的初始化，工作区已经准备好了：
   ![工作区准备完毕](/images/语法和标准库/2_一个简单的C程序/003.png)

可以见到项目里面新建了两个文件夹，源码文件 `main.c` 里面生成了一个输出 **hello world** 的示例代码；
源码文件上面还有一个叫 `.clang-format` 的文件，里面有些设置项

## 1'. C 项目的创建（以 CLion 为例）

1. 打开 **CLion**
   ![打开 CLion](/images/语法和标准库/2_一个简单的C程序/006.png)

2. 点击**新建项目**，选择 **C 可执行文件**，C 语言标准自选，推荐选择最新的；点击**创建**。（我的 CLion 装了汉化插件，如果你的是英文界面也点击对应位置按钮即可）
   ![新建项目](/images/语法和标准库/2_一个简单的C程序/007.png)
3. 项目创建完成后，会自动打开 `main.c` 文件，其中的内容是一串可以输出 `hello world` 的示例代码。此外，项目文件夹里面还有一个 `CMakeLists.txt` 文件，这是 CLion 项目的配置文件。
   ![创建完成](/images/语法和标准库/2_一个简单的C程序/008.png)

## 2. C 文件的编译运行（以 Lightly 为例）

1. 打开 `main.c` ，将上方代码粘贴进去，点击绿色三角形按钮即可编译运行
   ![编译运行](/images/语法和标准库/2_一个简单的C程序/004.png)
2. 在屏幕上输出了 `hello world`
   ![hello world](/images/语法和标准库/2_一个简单的C程序/005.png)

## 2'. C 文件的编译运行（以 CLion 为例）

1. 点击绿色三角形按钮即可编译运行，下方会弹出一个窗口，输出运行结果。
   ![编译运行](/images/语法和标准库/2_一个简单的C程序/009.png)

## 3. 包含标准库头文件

看以下的高亮代码行：

```c {1-2}
#include <stdio.h>
#include <assert.h>

/*
 * 这是 main 函数 (main function)
 * 一般情况下（有宿主环境）C 程序的入口点
 */
```

我们可以看到，代码的第一行和第二行具有 `#include <...>` 的形式，这是包含标准库头文件的写法。

1. 以 `#` 开头的是一条预处理器指令 (Preprocessor Directive)，我们将在 [10 - 预处理器](10_预处理器.md) 这一章中详细讲解预处理器的功能。
2. `#include` 指令是把目标文件的内容“原封不动”地粘贴到此文件，我们将在 [10.2 `#include`](10_预处理器/10_2_include.md) 这一节中详细讲解 `#include` 的用法。
3. `<stdio.h>` 是标准库提供的一个头文件，需要包含它才能使用其中的内容。第 11 章 [标准库概述](11_标准库概述.md) 会提到 `<stdio.h>` 这个头文件及其功能。

## 4. 注释 (Comment)

看以下的高亮代码行：

```c {4-7,10}
#include <stdio.h>
#include <assert.h>

/*
 * 这是 main 函数 (main function)
 * 一般情况下（有宿主环境）C 程序的入口点
 */
int main(void) {

    // 输出一行字
    puts("Hello world!");
```

这片代码中有两种注释：行内注释和块注释。我们将在 [3.1 注释](/教程/正文/语法和标准库/3_基本概念/3_1_注释.md) 中详细讲解。

## 5. main 函数

```c:line-numbers=4 {5}
/*
 * 这是 main 函数 (main function)
 * 一般情况下（有宿主环境）C 程序的入口点
 */
int main(void) {

    // 输出一行字
    puts("Hello world!");

```

### 5.1 程序入口点

1. 一般来说，一个 C 程序从 `main()` 函数开始执行，也从 `main()` 函数结束

### 5.2 main 函数的几种原型

1. 标准规定的：`int main(void)`
2. 标准规定的：`int main(int argc, char* argv[])`
3. 很多编译器实现的：`int main(int argc, char* argv[], char* envp[])`

## 6. 返回值 (return value, RV)

看下面的高亮代码行：

```c:line-numbers=17 {3}
    printf("%g\n", (double)a / b);

    return 0;
}
```

1. `return` 的东西是函数的返回值
2. 如果 `main()` 函数的返回值为 0，则说明程序正常退出。我们将在 [21 - 程序支持](21_程序支持.md) 中讲解 `main()` 函数退出时发生的一些情况，以及那时可以进行的一些操作。
3. 主函数正常执行到末尾如同返回 0。

## 7. 库函数

看下面的高亮代码行：

```c:line-numbers=10 {2,5,8}
    // 输出一行字
    puts("Hello world!");

    int a, b;
    scanf("%d%d", &a, &b);

    assert(b != 0);
    printf("%g\n", (double)a / b);
```

`puts` `scanf` `printf` 这三个是标准库提供的函数。它们的功能如下：

1. `puts` 用于输出字符串并换行。
2. `scanf` 用于读取数据。
3. `printf` 用于格式化输出。

除此之外，也可以定义自己的函数。我们将在 [6. 函数](6_函数.md) 中详细介绍如何定义自己的函数。

## 8. 初识断言 (Assertion)

看下面的高亮代码行：

```c:line-numbers=16 {1}
    assert(b != 0);
    printf("%g\n", (double)a / b);
```

我们可以看到，第 16 行具有 `assert( ... )` 的形式，它是一个断言。

### 8.1 什么是断言

断言是用于进行**调试**和**错误处理**的工具。

它允许程序员在代码中插入条件检查，以确保程序在运行时满足特定的前提条件。

如果断言的条件不成立，程序将终止执行并生成一条错误消息，提供关于出错位置和原因的信息。C 语言没有提供在断言不成立的时候打印自定义错误消息的接口。有个被普遍应用的技巧是使用[**逗号运算符**](/教程/正文/语法和标准库/4_表达式/4_1_运算符/4_1_7_逗号运算符.md)额外提供错误消息。

### 8.2 使用断言

```c {5}
#include <assert.h>

int main(void){
    int a = -5;
    assert(a > 0);
}
```

程序终止执行，因为断言的条件 `a > 0` 不成立。

控制台可能打印出以下内容：

```ansi
***.c:4: main: Assertion `a > 0' failed.
Program terminated with signal: SIGSEGV
```

### 8.3 用途

在**开发**和**调试**阶段用于**防御性编程**，缩小错误可能存在的范围，便于调试。

## 9. 强制类型转换

看下面的高亮代码行：

```c:line-numbers=16 {2}
    assert(b != 0);
    printf("%g\n", (double)a / b);
```

第 16 行的 `(double)a / b` 中，a 和 b 都是**整数类型**：根据 C 语言的规则，把除法运算符应用到两个整数上，会得到一个整数结果（向零取整：`5 / 2` 等于 `2`，`-5 / 2` 等于 `-2`）。

但当我们输入 `5 2` 时，我们希望程序输出 `2.5`，而不是 `2`。`(double)a` 表示将 `a` 强制转换为 `double` 类型（一种浮点数类型），然后再进行除法运算。根据**一般算术转换**的规则，浮点数除以整数结果会得到浮点数。

## 习题

1. 创建 C 语言项目，把本章的示例代码复制进你的项目中，并且进行编译运行。
2. 修改 `puts()` 函数中的内容，使得程序输出 `Hello, C!`。
3. _[1.2]_ 实验与观察：探索整数除法
   a. 暂时移除代码中的 `(double)` （强制类型转换），让除法变成 `a / b`。
   b. 运行程序，分别输入 `5 2`、`6 3`、`-5 2`，观察并记录输出结果。
   c. 尝试解释为什么结果是这样。这是否验证了教程中关于“整数除法向零取整”的说法？
4. _[1.2]_ 触发断言：理解 `assert`
   a. 运行原始程序，并在第二个整数输入 `0`。
   b. 仔细阅读并尝试理解控制台输出的错误信息。它告诉你错误发生在哪一个文件的哪一行吗？它告诉你失败的条件是什么吗？
5. _[1.3]_ 破坏与修复：理解 `#include`
   a. 将代码第一行的 `#include <stdio.h>` 的在行首加上 `//`。
   b. 尝试编译程序。你看到了什么样的编译错误（Compiler Error）？错误信息是否提到了 `puts`？
   c. 恢复 `#include <stdio.h>`，在 `#include <assert.h>` 的行首加上 `//`，再次编译。这次的错误信息又提到了什么？
   d. 通过这个实验，你能否总结出 `#include` 指令的作用是什么？

## 自测题

<Quiz
  type="single"
  :options="[
    { label: '5 / 2 = 2.5', value: 'A' },
    { label: '5 / 2 = 2', value: 'B' },
    { label: '-5 / 2 = -3', value: 'C' },
    { label: '5.0 / 2 = 2', value: 'D' }
  ]"
  answer="B"
>

<template #question>

根据 C 语言的规则，如果不使用强制类型转换，表达式 `5 / 2` 的结果是多少？
  
</template>

正确答案是 **B**。
  
在 C 语言中，对两个整数应用除法运算符 `/`，结果会向零取整。

* `5` 和 `2` 都是整数，所以结果截断小数部分，得到 `2`。
* `-5 / 2` 同样向零取整，得到 `-2`（而不是 -3）。
* 若要得到 `2.5`，至少有一个操作数必须是浮点数（如 `5.0 / 2` 或 `(double)5 / 2`）。

</Quiz>

<Quiz
  type="multi"
  :options="[
    { label: '用于确保程序运行时满足特定条件。', value: 'A' },
    { label: '当条件为假（false）时，程序会终止运行。', value: 'B' },
    { label: 'assert(b != 0) 意味着如果 b 不等于 0，程序就会报错。', value: 'C' },
    { label: '通常用于调试和开发阶段，进行防御性编程。', value: 'D' }
  ]"
  :answer="['A', 'B', 'D']"
>

<template #question>

关于 `assert`（断言），以下哪些描述是正确的？（多选）

</template>

* **A, B, D** 正确：断言用于检查程序运行时的前提条件。如果条件不满足（即为假），程序会终止并报告错误，这有助于在开发阶段发现 bug。
* **C** 错误：`assert(condition)` 的逻辑是“**我断定**这个条件是真的”。如果 `b != 0` 成立（真），程序**继续执行**；如果 `b != 0` 不成立（即 b 等于 0），程序才会报错终止。

</Quiz>

<CodeCompare left-title="缺少头文件" right-title="正确包含">

<template #left>

```c
// 编译报错！
// 编译器不知道 puts 是什么
int main(void) {
    puts("Hello"); 
    return 0;
}
```

</template>

<template #right>

```c
// 编译通过
// <stdio.h> 提供了 puts 的声明
#include <stdio.h>

int main(void) {
    puts("Hello");
    return 0;
}
```

</template>

</CodeCompare>

<Quiz
  type="single"
  :options="[
    { label: '它是一条预处理器指令，以 # 开头。', value: 'A' },
    { label: '它的作用是将目标文件的内容“复制粘贴”到当前文件。', value: 'B' },
    { label: '它必须放在 main 函数内部才能生效。', value: 'C' },
    { label: '<stdio.h> 是标准库提供的头文件，包含了输入输出函数的声明。', value: 'D' }
  ]"
  answer="C"
>

<template #question>

关于 `#include <stdio.h>`，以下哪项描述是 **错误** 的？

</template>

正确答案是 **C**（即描述错误的选项）。
  
* `#include` 是一条预处理指令，通常写在文件的最开头，**不需要**也不应该放在 `main` 函数内部（虽然语法上允许放在函数内，但这是一种极不推荐的写法，且通常不符合包含头文件的惯例）。
* A, B, D 的描述都是正确的。

</Quiz>
