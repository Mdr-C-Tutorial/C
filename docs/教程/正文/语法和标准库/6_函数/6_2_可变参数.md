# 可变参数

可变参数函数允许形参个数在调用时变化，典型例子是 `printf`。这类函数的核心在 `<stdarg.h>`：`va_list`、`va_start`、`va_arg`、`va_end`（以及 `va_copy`）。

## 1. 约束与设计要点

可变参数部分不会携带自动类型信息，函数本身无法“猜出”每个实参的真实类型和数量。因此你必须显式提供协议，例如“第一个形参给出数量”或“使用格式字符串描述类型”。没有协议的可变参数接口几乎必然不可维护。

## 2. 一个安全的最小模式

```c
#include <stdarg.h>
#include <stddef.h>

long long sum_ints(size_t count, ...) {
    va_list ap;
    long long total = 0;

    va_start(ap, count);
    for (size_t i = 0; i < count; ++i) {
        total += va_arg(ap, int);
    }
    va_end(ap);

    return total;
}
```

该函数把 `count` 作为协议字段，调用方与被调方都能确定读取边界。

## 3. 默认实参提升

在可变参数部分，`float` 会提升为 `double`，较窄整数类型会提升为 `int` 或 `unsigned int`。因此 `va_arg` 取值类型必须与提升后类型一致，否则行为未定义。

## 4. 实践建议

能用普通接口表达时，不要为了“灵活”而使用可变参数。只有当调用形态确实需要开放参数个数，且协议可以被静态检查或清楚文档化时，可变参数才是好选择。
