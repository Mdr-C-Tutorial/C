# 本地化库

本地化库 (Localization) 让程序根据地区规则处理数字、货币、排序和消息文本。它的核心头文件是 `<locale.h>`，并与 `<ctype.h>`、`<string.h>`、`<wchar.h>` 等库能力联动。

这部分能力主要面向宿主实现；若目标是独立实现环境，需要先确认运行时是否提供对应支持。

## 1. 核心接口 `setlocale`

`setlocale` 用于查询或设置当前本地化类别。若设置失败会返回空指针，因此任何切换动作都应检查返回值。

```c
#include <locale.h>
#include <stdio.h>

int main(void) {
    const char *result = setlocale(LC_ALL, "");
    if (result == NULL) {
        puts("setlocale failed");
        return 1;
    }

    puts(result);
    return 0;
}
```

传入空字符串 `""` 的常见语义是“按运行环境默认地区设置初始化”。

## 2. 数字与货币格式

`localeconv` 返回当前地区的格式描述，例如小数点符号和货币分隔。它适合在“展示层”做格式化，而不应拿来改变核心计算逻辑。计算逻辑应保持地区无关，输入输出再做本地化适配。

## 3. 排序与比较

字符串排序若需要遵循地区规则，应优先使用 `strcoll` 和 `strxfrm`，而不是直接按字节比较。字节序比较只适合协议字段和机器可读数据，不适合人类语言文本。

## 4. 实践建议

本地化配置应在程序启动早期一次性完成，避免在业务流程中频繁切换全局地区状态。若项目规模较大，建议把“格式化输出”集中在独立模块中管理，避免全局状态影响扩散。
