# 并发支持库

C11 开始，标准库提供了跨平台并发接口，核心头文件是 `<threads.h>` 与 `<stdatomic.h>`。它们分别解决“线程与同步原语”以及“原子读写与内存序”两个层面的问题。

其中 `<stdatomic.h>` 在现代实现里通常可用，而 `<threads.h>` 在不同编译器上的支持度不完全一致；需要时可在工程层做一层平台适配。

## 1. 本章结构

本章先介绍线程基础与原子操作，再进入互斥、条件等待与线程局部存储。阅读顺序建议保持与目录一致，因为后续机制都建立在线程和内存可见性的基础上。

1. [22.1 线程](/教程/正文/语法和标准库/22_并发支持/22_1_线程)
2. [22.2 原子操作](/教程/正文/语法和标准库/22_并发支持/22_2_原子操作)
3. [22.3 互斥](/教程/正文/语法和标准库/22_并发支持/22_3_互斥)
4. [22.4 条件等待](/教程/正文/语法和标准库/22_并发支持/22_4_条件变量)
5. [22.5 线程局部存储](/教程/正文/语法和标准库/22_并发支持/22_5_线程局部存储)

## 2. 并发代码的底线

只要多个线程可能同时访问同一对象，就必须明确同步策略：要么使用原子操作，要么使用互斥保护并保证访问路径一致。未同步的并发读写会形成数据竞争，标准层面属于未定义行为。

## 3. 设计建议

并发设计优先追求“正确性可证明”，再考虑性能微调。先写出简单、清晰、可复核的同步模型，再根据压力点做局部优化，通常比一开始追求复杂无锁结构更稳妥。
